<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.dao.FruitDao">


    <resultMap id="FruitMap" type="com.entity.Fruit" >
        <result column="name" property="name"/>
        <result column="price" property="price"/>
        <result column="createTime" property="createTime"/>
        <!--<result column="updateTime" property="updateTime"/>-->
    </resultMap>

    <sql id="FruitFeild">
       id, name,price,address,createTime
    </sql>

    <!--db：支持主键自增。 设置useGeneratedKeys=true（默认false） keyProperty的值则是db自增的主键绑定到javabean中的对应属性-->
    <insert id="addFruit" parameterType="com.entity.Fruit" useGeneratedKeys="true" keyProperty="id" >
        INSERT into fruit(name,price,address,createTime) VALUES (#{name },#{price},#{address},#{createTime});
    </insert>


    <update id="updateFruit" parameterType="com.entity.Fruit">
        UPDATE fruit
        <set>
            name=#{name},price=#{price},updateTime=#{updateTime}
        </set>
        <where>
            id=#{id};
        </where>
    </update>

    <delete id="deleteFruit" parameterType="int">
        DELETE FROM fruit where id=#{id};
    </delete>

    <select id="queryFruit" parameterType="int" resultMap="FruitMap">
        SELECT <include refid="FruitFeild"  />
        from fruit
        WHERE id=#{id};
    </select>


    <!--<select id="queryFruit" parameterType="int" resultType="com.entity.Fruit">-->
        <!--SELECT *-->
        <!--from fruit-->
        <!--WHERE id=#{id};-->
    <!--</select>-->

    <!--include refid 应用sql 标签的内容，使sql复用性更高-->
    <select id="queryFruits"  resultMap="FruitMap">
        SELECT <include refid="FruitFeild"  />
        from fruit;
    </select>


    <!--批量查询

foreach的主要用在构建in条件中，它可以在SQL语句中进行迭代一个集合。

    forecah:

     item表示集合中每一个元素进行迭代时的别名，
    index指 定一个名字，用于表示在迭代过程中，每次迭代到的位置，
    open表示该语句以什么开始，
    separator表示在每次进行迭代之间以什么符号作为分隔 符，
    close表示以什么结束。

    collection:传入的值


    -->
    <select id="queryFruitsByIds1" resultType="com.entity.Fruit">
        SELECT * from fruit
        WHERE  id in
        <foreach collection="list" item="aas" index="index" open="(" separator="," close=")">
            #{aas}
        </foreach>
    </select>

    <!--如果传入的是map  collection的值则是map中的key-->
    <select id="queryFruitsByIds2" resultType="com.entity.Fruit">
        SELECT * from fruit
        WHERE  id in
        <foreach collection="ids" item="item" index="index" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>

    <select id="queryFruitsByIds3" resultType="com.entity.Fruit" >
        SELECT * from fruit
        WHERE  id in
        <foreach collection="array" item="item" index="index" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>

    <!--
    trim标记是一个格式化的标记，可以完成set或者是where标记等功能
    prefix:前缀
    prefixOverrides：去掉第一个and或者是or
    suffix：后缀
    suffixOverrides：重写后缀
    -->
    <select id="queryFruitsLike" resultType="com.entity.Fruit" parameterType="com.entity.Fruit" >
        SELECT * FROM fruit
        <trim prefix="where" prefixOverrides="AND|OR" suffix=";" >
            <if test="name != null">
                name LIKE #{name}
            </if>
            <if test="address !=null">
               OR address LIKE #{address}
            </if>
        </trim>
    </select>

</mapper>